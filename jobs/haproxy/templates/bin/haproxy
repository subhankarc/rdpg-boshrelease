#!/var/vcap/packages/bash-4.3/bin/bash

source "$(dirname $(dirname ${0}))/shell/env"

action=${1:-""}
case ${action} in
  (start|*)
    if (( ${pid:-0} > 0 )) && [[ -d /proc/${pid:-a} ]]
    then 
      echo "haproxy already running with pid ${pidFile}"
      exit 0
    fi
    exec ${pkgPath}/bin/haproxy -f "${configFile}" -p "${pidFile}" -D
    ;;
  (stop)
    send_signal TERM 
    ;;
  (reload)
    if (( ${pid:-0} > 0 ))
    then exec ${pkgPath}/bin/haproxy -f "${configFile}" -p "${pidFile}" -sf ${pid}
    fi
    ;;
esac
