#!/var/vcap/packages/bash-4.3/bin/bash

source "$(dirname $(dirname ${0}))/shell/env"

( user run ${binary} agent -server -bootstrap-expect ${#consulNodes[@]} \
  "${binaryArgs[@]}" ) &

# TODO: Instead of using sleep, how do we test if the consul server is ready 
#       to process joins?
sleep 3

user exec ${binary} join "${consulNodes[@]}"
