#!/usr/bin/env bash

source "$(dirname $(dirname ${0}))/shell/env"

trap graceful_stop SIGTERM # Handle term signal sent by control script stop action.

# echo $$ > ${pidFile} # Write the shell script's PID to the pidFile

( user run ${binary} agent -server -bootstrap-expect ${#consulNodes[@]} \
  "${binaryArgs[@]}" ) &

# TODO: Instead of using sleep, how do we test if the consul server is ready 
#       to process joins?
sleep 3

user exec ${binary} join "${consulNodes[@]}"
